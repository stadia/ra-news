<% content_for :title, @article.title_ko %>

<div class="space-y-6 max-w-6xl mx-auto" id="<%= dom_id @article %>">
  <div id="articleDetail" class="bg-gray-800 rounded-xl shadow-md overflow-hidden border border-gray-700">
    <div class="p-4 md:p-8">
        <h1 class="text-2xl font-bold text-gray-100 mb-3"><%= @article.title_ko %></h1>

        <h2 class="text-xl font-semibold text-white mb-3"><%= @article.title %></h2>

        <div class="flex flex-wrap items-center text-xs text-gray-400 mb-3 md:mb-6">
            <span class="mr-4 inline-flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 mr-1 text-gray-500">
                <path d="M10 8a3 3 0 100-6 3 3 0 000 6zM3.465 14.493a1.23 1.23 0 00.41 1.412A9.957 9.957 0 0010 18c2.31 0 4.438-.784 6.131-2.1.43-.333.604-.903.408-1.41a7.002 7.002 0 00-13.074.003z" />
              </svg>
              <%= @article.user&.name || 'Unknown' %>
            </span>
            <span class="mr-4 inline-flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 mr-1 text-gray-500">
                <path fill-rule="evenodd" d="M5.75 2a.75.75 0 01.75.75V4h7V2.75a.75.75 0 011.5 0V4h.25A2.75 2.75 0 0118 6.75v8.5A2.75 2.75 0 0115.25 18H4.75A2.75 2.75 0 012 15.25v-8.5A2.75 2.75 0 014.75 4H5V2.75A.75.75 0 015.75 2zm-1 5.5c0-.414.336-.75.75-.75h10.5a.75.75 0 010 1.5H5.5a.75.75 0 01-.75-.75z" clip-rule="evenodd" />
              </svg>
              <%= @article.published_at&.strftime("%Y년 %m월 %d일") || 'N/A' %>
            </span>
            <%= link_to @article.url, target: "_blank", class: "inline-flex items-center text-base text-blue-400 hover:text-blue-300 hover:underline font-medium" do %>
              <%= @article.url %>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 ml-1">
                <path fill-rule="evenodd" d="M4.25 5.5a.75.75 0 000 1.5h5.5a.75.75 0 000-1.5h-5.5zm0 3a.75.75 0 000 1.5h3.5a.75.75 0 000-1.5h-3.5zm0 3a.75.75 0 000 1.5h5.5a.75.75 0 000-1.5h-5.5zm8-5a.75.75 0 01.75-.75h.5a.75.75 0 01.75.75v.5c0 .414.336.75.75.75h.5a.75.75 0 01.75.75v.5a.75.75 0 01-.75.75h-.5a.75.75 0 01-.75-.75v-.5a.75.75 0 00-.75-.75h-.5a.75.75 0 01-.75-.75v-.5zM5 3.25a.75.75 0 01.75-.75h8.5a.75.75 0 01.75.75v8.5a.75.75 0 01-.75.75h-8.5a.75.75 0 01-.75-.75v-8.5z" clip-rule="evenodd" />
                <path d="M3 4.75A2.75 2.75 0 015.75 2h8.5A2.75 2.75 0 0117 4.75v8.5A2.75 2.75 0 0114.25 16h-8.5A2.75 2.75 0 013 13.25v-8.5zm2.75-.904a1.25 1.25 0 00-1.25 1.25v8.5c0 .69.56 1.25 1.25 1.25h8.5c.69 0 1.25-.56 1.25-1.25v-8.5c0-.69-.56-1.25-1.25-1.25h-8.5z" />
              </svg>
            <% end %>
        </div>

        <div class="border-t border-b border-gray-700 py-6">
            <h2 class="text-xl font-semibold text-gray-100 mb-4">3줄 요약</h2>
            <% if @article.summary_key.is_a?(Array) %>
                <ul class="list-disc pl-5 space-y-1 my-4">
                    <% @article.summary_key&.each do |item| %>
                        <li class="text-gray-300 text-sm leading-relaxed"><%= item %></li>
                    <% end %>
                </ul>
            <% end %>
        </div>

        <div class="py-4 md:py-8 mx-auto">
            <div class="prose prose-lg max-w-none text-gray-300 leading-relaxed article-content">
                <% if @article.summary_detail.is_a?(Hash) %>
                    <div class="mb-4 md:mb-8 p-3 md:p-6 bg-gray-700 rounded-lg">
                        <p class="text-gray-300 leading-relaxed">
                            <%= @article.summary_detail["introduction"] %>
                        </p>
                    </div>

                    <div class="mb-4 md:mb-8 p-3 md:p-6 bg-gray-700 rounded-lg" id="article-detail-body">
                        <%= Kramdown::Document.new(@article.summary_detail["body"]).to_html.html_safe %>
                    </div>

                    <div class="mb-4 md:mb-8 p-3 md:p-6 bg-gray-700 rounded-lg">
                        <p class="text-gray-300 leading-relaxed">
                            <%= @article.summary_detail["conclusion"] %>
                        </p>
                    </div>
                <% end %>
            </div>
        </div>
    </div>
  </div>

  <!-- 댓글 섹션 -->
  <div class="bg-gray-800 rounded-xl shadow-md overflow-hidden border border-gray-700">
    <div class="p-4 md:p-8">
      <h3 class="text-xl font-semibold text-gray-100 mb-6">댓글 (<%= @comments.count %>)</h3>

      <!-- 댓글 작성 폼 -->
      <% if authenticated? %>
        <div class="mb-8 p-4 bg-gray-700 rounded-lg" id="comment_form">
          <%= form_with model: [@article, @comment], local: true, class: "space-y-4" do |form| %>
            <div>
              <%= form.text_area :body,
                  placeholder: "댓글을 작성해주세요...",
                  rows: 3,
                  class: "w-full p-3 bg-gray-600 border border-gray-500 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none" %>
            </div>
            <div class="flex justify-end">
              <%= form.submit "댓글 작성",
                  class: "px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors" %>
            </div>
          <% end %>
        </div>
      <% else %>
        <div class="mb-8 p-4 bg-gray-700 rounded-lg text-center">
          <p class="text-gray-300 mb-3">댓글을 작성하려면 로그인이 필요합니다.</p>
          <%= link_to "로그인", new_session_path,
              class: "inline-block px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors" %>
        </div>
      <% end %>

      <!-- 댓글 목록 -->
      <div id="comments" class="space-y-4">
        <% if @comments.any? %>
          <% @comments.each do |comment| %>
            <div class="p-4 bg-gray-700 rounded-lg border-l-4 border-blue-500">
              <div class="flex justify-between items-start mb-3">
                <div class="flex items-center space-x-3">
                  <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center">
                    <span class="text-white font-semibold text-sm">
                      <%= comment.user&.name&.first&.upcase || 'U' %>
                    </span>
                  </div>
                  <div>
                    <p class="text-white font-medium"><%= comment.user&.name || 'Unknown User' %></p>
                    <p class="text-gray-400 text-sm">
                      <%= time_ago_in_words(comment.created_at) %> 전
                    </p>
                  </div>
                </div>
                <% if authenticated? && (Current.user == comment.user || Current.user&.admin?) %>
                  <%= link_to comment_path(comment),
                      method: :delete,
                      data: {
                        confirm: "정말 이 댓글을 삭제하시겠습니까?",
                        turbo_method: :delete
                      },
                      class: "text-red-400 hover:text-red-300 text-sm" do %>
                    삭제
                  <% end %>
                <% end %>
              </div>
              <div class="text-gray-300 leading-relaxed">
                <%= simple_format(comment.body) %>
              </div>
            </div>
          <% end %>
        <% else %>
          <div class="text-center py-8">
            <p class="text-gray-400">아직 댓글이 없습니다. 첫 번째 댓글을 작성해보세요!</p>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>
